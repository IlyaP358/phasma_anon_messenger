<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Group Chat - phasma</title>
  <link rel="icon" type="image/png" href="/static/icon.png">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="/static/css/fluent.css">
  <link rel="stylesheet" href="/static/css/group_chat.css">
</head>

<body>
  <div id="drag-drop-overlay">
    <div class="drag-drop-box">
      <img src="/static/phasma_file.png" alt="Upload" class="drag-drop-icon" />
      <p class="drag-drop-text">Upload File</p>
    </div>
  </div>

  <div id="error-notification"></div>

  <div id="confirm-modal" class="modal-overlay">
    <div class="modal-dialog">
      <div class="modal-title">‚ö†Ô∏è Delete Message</div>
      <div class="modal-message">Are you sure you want to delete this message?
        This action cannot be undone.</div>
      <div class="modal-buttons">
        <button class="modal-btn modal-btn-cancel" id="modal-cancel">Cancel</button>
        <button class="modal-btn modal-btn-confirm" id="modal-confirm">Delete</button>
      </div>
    </div>
  </div>

  <div id="delete-modal" class="modal-overlay">
    <div class="modal-dialog">
      <div class="modal-title">Delete Group</div>
      <div class="modal-message">
        <div id="delete-error"></div>
        <p style="color: #ccc; margin-bottom: 1em;">
          ‚ö†Ô∏è This action cannot be undone. All messages and files will be permanently deleted.
        </p>
        <div style="margin-bottom: 1em;">
          <label style="display:block; color:#0f0; margin-bottom:0.5em; font-weight:bold;">Root Password</label>
          <input type="password" id="delete-password" placeholder="Enter root password"
            style="width:100%; padding:0.5em; background:#222; border:1px solid #333; color:#fff;">
        </div>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn modal-btn-cancel" id="btn-cancel-delete">Cancel</button>
        <button class="modal-btn modal-btn-confirm" id="btn-confirm-delete">Delete Group</button>
      </div>
    </div>
  </div>
  </div>

  <div id="leave-modal" class="modal-overlay">
    <div class="modal-dialog">
      <div class="modal-title">‚ö†Ô∏è Leave Group</div>
      <div class="modal-message">
        <p style="color: #ccc; margin-bottom: 1em;">
          Warning: If you leave this group, it will be removed from your personal account. Are you sure?
        </p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn modal-btn-cancel" id="btn-cancel-leave">Cancel</button>
        <button class="modal-btn modal-btn-confirm" id="btn-confirm-leave">Leave Group</button>
      </div>
    </div>
  </div>



  <div class="chat-wrapper">
    <div class="groups-sidebar">
      <div class="groups-header">
        <button id="btn-back-groups" class="btn-back">‚Üê Back</button>
        <div class="groups-title">My Groups</div>
      </div>
      <div id="groups-list"></div>
    </div>

    <div class="chat-main">
      <div class="chat-header">
        <button id="btn-toggle-groups" class="input-button mobile-only" style="margin-right: 10px;">‚ò∞</button>
        <div class="chat-header-left">
          <h3 id="group-name">Loading...</h3>
          <div class="chat-user-badge">Logged as:
            <span id="chat-user">...</span>
          </div>
        </div>
        <button id="btn-toggle-members" class="input-button">üë•</button>
      </div>

      <div id="out">
        <div id="load-more-container">
          <button id="load-more-btn">‚Üì Load older messages</button>
        </div>
        <div id="messages-container"></div>
      </div>

      <div id="input-container">
        <div id="file-preview-container">
          <div class="preview-thumbnail" id="preview-thumbnail">
            <img id="preview-img" style="display: none;" />
            <video id="preview-video" style="display: none;"></video>
            <img id="preview-file-icon" class="file-icon" style="display: none;" src="/static/phasma_file.png" />
          </div>
          <div class="preview-info">
            <div class="preview-source" id="preview-source"></div>
            <div class="preview-filename" id="preview-filename"></div>
            <div class="preview-filesize" id="preview-filesize"></div>
          </div>
          <div class="preview-actions">
            <button type="button" class="preview-btn" id="preview-remove-btn">‚úï Remove</button>
          </div>
        </div>

        <div class="input-row">
          <input type="text" id="in" autocomplete="off" placeholder="Type a message" />
          <button type="button" class="input-button" id="upload-btn">+ File</button>
          <button type="button" class="input-button" id="emoji-btn">üòÇ</button>
          <button type="button" class="input-button" id="send-btn">‚Ü≥</button>
        </div>

        <input id="file-input" type="file"
          accept="image/jpeg,image/png,image/gif,image/webp,video/mp4,video/quicktime,video/webm,audio/mpeg,audio/mp4,audio/ogg,audio/wav,application/pdf,text/plain" />
      </div>
    </div>

    <div class="members-sidebar">
      <div class="members-header">
        Members <span class="members-count" id="members-count">(0)</span>
        <button id="leave-btn">Leave Group</button>
      </div>
      <div id="members-list"></div>
    </div>
  </div>

  <div id="emoji-picker-modal" class="emoji-picker-modal">
    <div class="emoji-picker-container">
      <div class="emoji-picker-header">
        <input type="text" id="emoji-search" class="emoji-search" placeholder="Search emoji..." />
        <button type="button" class="emoji-close-btn" id="emoji-close-btn">x</button>
      </div>

      <div class="emoji-categories-tabs" id="emoji-categories-tabs">
        <!-- Categories will be injected here -->
      </div>

      <div class="emoji-picker-content">
        <div id="emoji-grid" class="emoji-grid"></div>
      </div>

      <!-- Variant Popup -->
      <div id="emoji-variant-popup" class="emoji-variant-popup" style="display: none;">
        <div class="emoji-variant-grid" id="emoji-variant-grid"></div>
      </div>
    </div>
  </div>

  <script nonce="{{ nonce }}">
    const GROUP_ID = {{ group_id| tojson }};
    const TEMPLATE_USER = {{ user| tojson }};
    const TEMPLATE_GROUP_TOKEN = {{ auth_token| tojson }};
    const GROUP_NAME = {{ group_name| tojson }};
  </script>
  <audio id="notification-sound" src="/static/phasma_notification_sound.mp3" preload="auto"></audio>
  <script nonce="{{ nonce }}" src="/static/js/group_chat.js"></script>
</body>

</html>